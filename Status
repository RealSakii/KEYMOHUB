--======================--
--      KEYMOHUB GUI    --
--  แยกหมวดหมู่ Status  --
--======================--

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- GUI visibility
local guiVisible = true

-- ชื่อฟังก์ชันและหมวดหมู่
local categories = {
    Movement = {
        {name="วิ่งไว (X/RightControl)", key=Enum.KeyCode.X, state=false},
        {name="กระโดดสูง (B)", key=Enum.KeyCode.B, state=false},
        {name="วาร์ป (T)", key=Enum.KeyCode.T, state=false},
        {name="บินไปหา (H)", key=Enum.KeyCode.H, state=false},
        {name="บินลอย (N)", key=Enum.KeyCode.N, state=false},
    },
    Combat = {
        {name="Lock On (M3)", key=Enum.UserInputType.MouseButton3, state=false},
        {name="SAFE FLING (G)", key=Enum.KeyCode.G, state=false},
    },
    Visual = {
        {name="ESP Box (P)", key=Enum.KeyCode.P, state=false},
    }
}

-- สร้าง GUI
local gui = Instance.new("ScreenGui")
gui.Name = "KEYMOHUB_GUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 500)
frame.Position = UDim2.new(0.5, -175, 0.5, -250)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Active = true
frame.Visible = true
frame.Draggable = true
frame.Parent = gui
local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 12)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundTransparency = 1
title.Text = "KEYMOHUB"
title.TextColor3 = Color3.fromRGB(0,170,255)
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.Parent = frame

-- ลำดับหมวดหมู่ใหม่: Combat -> Movement -> Visual
local categoryOrder = {"Combat", "Movement", "Visual"}

-- แยกหมวดหมู่
local yOffset = 50
local labels = {}

for _, categoryName in ipairs(categoryOrder) do
    local funcs = categories[categoryName]
    if funcs then
        -- หมวดหมู่ Label
        local catLabel = Instance.new("TextLabel")
        catLabel.Size = UDim2.new(0.95, 0, 0, 30)
        catLabel.Position = UDim2.new(0.025, 0, 0, yOffset)
        catLabel.BackgroundColor3 = Color3.fromRGB(40,40,40)
        catLabel.Text = categoryName
        catLabel.TextColor3 = Color3.fromRGB(0,170,255)
        catLabel.Font = Enum.Font.GothamBold
        catLabel.TextScaled = true
        catLabel.Parent = frame
        local c = Instance.new("UICorner", catLabel)
        c.CornerRadius = UDim.new(0,8)
        yOffset = yOffset + 35

        -- ฟังก์ชันแต่ละอัน
        for i, func in ipairs(funcs) do
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.9, 0, 0, 30)
            label.Position = UDim2.new(0.05, 0, 0, yOffset)
            label.BackgroundColor3 = Color3.fromRGB(170,50,50)
            label.Text = func.name .. ": ปิด"
            label.TextColor3 = Color3.fromRGB(255,255,255)
            label.Font = Enum.Font.GothamBold
            label.TextScaled = true
            label.Parent = frame
            local corner = Instance.new("UICorner", label)
            corner.CornerRadius = UDim.new(0,8)

            labels[func] = label
            yOffset = yOffset + 35
        end

        yOffset = yOffset + 10 -- เว้นระยะระหว่างหมวดหมู่
    end
end

-- ฟังก์ชันอัปเดต Status
local function updateLabel(func)
    local label = labels[func]
    if func.state then
        label.Text = func.name .. ": เปิด"
        label.BackgroundColor3 = Color3.fromRGB(0,170,255)
    else
        label.Text = func.name .. ": ปิด"
        label.BackgroundColor3 = Color3.fromRGB(170,50,50)
    end
end

-- ตรวจจับคีย์
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end

    -- Toggle GUI
    if input.KeyCode == Enum.KeyCode.LeftControl then
        guiVisible = not guiVisible
        frame.Visible = guiVisible
    end

    -- Loop ผ่านหมวดหมู่
    for _, funcs in pairs(categories) do
        for _, func in ipairs(funcs) do
            if (input.KeyCode and input.KeyCode == func.key) or (input.UserInputType and input.UserInputType == func.key) then
                func.state = not func.state
                updateLabel(func)
            end
        end
    end
end)
